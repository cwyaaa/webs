
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>收藏夹示例</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Firebase 登录和收藏功能</h2>

  <!-- 登录模块 -->
  <div id="login-section">
    <input type="email" id="email" placeholder="邮箱">
    <input type="password" id="password" placeholder="密码">
    <button onclick="login()">登录</button>
    <button onclick="signup()">注册</button>
  </div>

  <!-- 收藏夹模块（登录后显示） -->
  <div id="bookmark-section" style="display:none;">
    <h3>欢迎！添加你的收藏：</h3>
    <input type="text" id="bookmark-title" placeholder="标题">
    <input type="url" id="bookmark-url" placeholder="链接">
    <button onclick="addBookmark()">保存</button>
    <p id="status"></p>
    <button onclick="logout()">登出</button>

    <h3>我的收藏</h3>
    <ul id="bookmark-list"></ul>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCcsz9Lg3KmgvD_SXUdy4V5x7aCQtSdI-s",
      authDomain: "webs-d0804.firebaseapp.com",
      projectId: "webs-d0804",
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("注册成功！"))
        .catch(err => alert(err.message));
    }

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => alert("登录成功！"))
        .catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut();
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("bookmark-section").style.display = "block";
        loadBookmarks(user.uid);
      } else {
        document.getElementById("login-section").style.display = "block";
        document.getElementById("bookmark-section").style.display = "none";
      }
    });

    function addBookmark() {
      const title = document.getElementById("bookmark-title").value;
      const url = document.getElementById("bookmark-url").value;
      db.collection("bookmarks").add({
        title: title,
        url: url,
        createdAt: new Date(),
        userId: auth.currentUser.uid
      }).then(() => {
        document.getElementById("status").innerText = "收藏已保存！";
        loadBookmarks(auth.currentUser.uid);
      }).catch(err => {
        document.getElementById("status").innerText = "出错：" + err.message;
      });
    }

    function loadBookmarks(userId) {
      const list = document.getElementById("bookmark-list");
      list.innerHTML = "";
      db.collection("bookmarks")
        .where("userId", "==", userId)
        .orderBy("createdAt", "desc")
        .get()
        .then(querySnapshot => {
          querySnapshot.forEach(doc => {
            const li = document.createElement("li");
            const data = doc.data();
            li.innerHTML = `<a href="${data.url}" target="_blank">${data.title}</a>`;
            list.appendChild(li);
          });
        });
    }
  </script>
</body>
</html>
